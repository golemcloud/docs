import { Callout } from "nextra/components"

# API Gateway

Golem's API Gateway makes it easy for you to build WASM based microservices by translating incoming requests into invocations of worker functions and constructing responses based on the return values of those functions.

## APIs

The API Gateway allows you to define an **API**. An API consists of a set **routes** and a set of **deployments**.

To view your APIs go to [https://console.golem.cloud](https://console.golem.cloud/). From there click on “Projects” in the top navigation bar, select a project where you have uploaded at least one worker template, and then select “APIs”.

This will list all the APIs you have defined in your project. To create a new API click the “Create New” button in the top right and specify an **API name** and **version**.

Now that we have an API we're ready to create some routes!

## Routes

Creating a new API will take you to the overview page of that API, which shows an overview of the routes and deployments associated with the API. To view all the routes associated with the API click the “View All” button under routes.

Right now this doesn't include any routes. Let's click the “Add New” button to create our first route.

Every route consists of four parts:

1. **Http Endpoint** - The HTTP Endpoint defines what incoming requests the route handles and consists of a **method** (e.g. GET, POST) and a **path**. The path may also capture path and query variables, indicated by curly braces, that will be available in the worker binding. So for example `users/{user-id}?{active}` would match on the request `users/123?active=true` and would capture `123` as the value of `user-id` and `true` as the value of `active`.
2. **Worker Binding** - The worker binding describes which worker function the route should invoke. This includes the worker template to use, the identifier of the specific worker associated that that template to use, and the function to invoke.

<Callout >
If you invoke a function on a worker that does not exist yet the worker will be created and then the function will be invoked on the worker. So it is easy to create a new worker based on information contained in the request.

</Callout>

1. **Parameters** - The parameters describe how information from the request will be used to construct the parameters to the worker function. These can be constants, path or query variables captured above, headers, body fields, or even the entire body.
2. **Response** - The response describes how the value returned by the worker function should be translated back into an HTTP response. The default is a successful response with a 200 status code and the function return value in the body, but you can customize the status code, body, and headers.

To make this route definition as flexible as possible Golem provides a powerful express language that allows you to capture information as variables and perform conditional logic.

Here is an overview of the syntax you can use for capturing variables in your HTTP endpoint definition and accessing them later:

- **Path Parameters** - Defined with curly braces in path definition, for example `users/{user-id}`. Accessed as `${path.user-id}`.
- **Query Parameters** - Defined with curly braces in path definition following `?`, for example `users/{user-id}?{active}`. Accessed as `${path.active}`.
- **Request Body** - Accessed as `${request.body}`.
- **Request Body Fields** - Accessed as `${request.body.field}`, where `field` is the name of the field.
- **Request Headers** - Accessed as `${request.headers.header}`, where `header` is the name of the header.

<Callout>
Code is always indicated by `${…}`. Any text that is not wrapped this way is interpreted as a string.

</Callout>

You can also use conditional logic. For example, you might want to have a different worker handle the request depending on one of the parameters.

You can do this with `${if condition then x else y}` syntax or `${if condition1 then x elseif condition2 then y else z}` if you have more than three branches.

In addition to equality comparison operators (`≤`, `<`, `>=`, and `>`) are currently supported in conditions.

<Callout type="info">
The user interface of the management console has extensive help to make it easy for you to write these expressions and make sure that they are correct and well typed as you do so.

</Callout>

## Deployments

So far we have just described our API. We haven't deployed it anywhere where it can serve live traffic.

To view all of our deployments go back to the overview and then click on “View All” under deployments. This will show us all of our current deployments.

When we are ready we can deploy our API by clicking “New Deployment”. We then need to specify a domain and subdomain.

By default, our API will be deployed to a subdomain of `api.golem.cloud`. This makes it incredibly easy to stand up a web service for rapid development, but eventually you will probably want to shift to using a custom domain name that reflects the product or service you are offering.

To do this click on “Configure Custom Domain” after “New Deployment” and follow the instructions there. After specifying your custom domain you will be provided with a set of custom name servers that you will need to add to your domain registrar (e.g. GoDaddy) and Golem will then be able to confirm they have been successfully configured.

With this you're ready to go! Try hitting the endpoints you have defined with requests and see the responses you get back powered by your WASM workers.
