## Update API definitions and deployments

We will update the API definition by adding more routes to the existing API definition.


```yaml
# Schema for IDEA:
# $schema: https://schema.golem.cloud/app/golem/1.2.2-dev.1/golem.schema.json
# Schema for vscode-yaml
# yaml-language-server: $schema=https://schema.golem.cloud/app/golem/1.2.2-dev.1/golem.schema.json

# See https://learn.golem.cloud/docs/app-manifest#field-reference for field reference

components:
  amazon:shopping-cart:
    template: rust

httpApi:
  definitions:
    shopping-cart:
      version: '0.0.2'
      routes:
        - method: POST
          path: /v1/{user}/add-to-cart
          binding:
            type: default
            componentName: "amazon:shopping-cart"
            response: |
              let user: u32 = request.path.user;
              let worker = instance("cart-${user}");
              worker.add-item(request.body);
              "successfully added item to the cart"
        - method: GET
          path: /v1/{user}/contents
          binding:
            type: default
            componentName: "amazon:shopping-cart"
            response: |
              let user: u32 = request.path.user;
              let worker = instance("cart-${user}");
              worker.get-cart-contents()
        - method: POST
          path: /v1/{user}/checkout
          binding:
            type: default
            componentName: "amazon:shopping-cart"
            response: |
              let user: u32 = request.path.user;
              let worker = instance("cart-${user}");
              worker.checkout()

  # Uncomment if you want to deploy your api
  deployments:
    local:
    - host: localhost:9006
      definitions:
       - shopping-cart

```

Here we added more routes into the same API definition. Now simply redeploy
using

```sh
golem api deploy

```

The interactive shell will force you to update the version of the API definition to not lose track of the changes,
and keep a note that you can have advanced management of the APIs using `golem api definition` and `golem api deploy` commands
allowing you to switch back to the previous API if needed.


### Try out the updated APIs

#### Route 1
```sh
curl -X POST http://localhost:9006/v1/100/add-to-cart -d '{"product-id": "foo", "name": "foo", "price": 42, "quantity": 42}' -H "accept: application/json"
```

```json
"successfully added item to the cart
```

#### Route 2
```sh
curl -X GET http://localhost:9006/v1/100/contents -H "accept: Application/json"
```
```json
[{"name":"foo","price":42.0,"product-id":"foo","quantity":42},{"name":"foo","price":42.0,"product-id":"foo","quantity":42},{"name":"foo","price":42.0,"product-id":"foo","quantity":42},{"name":"foo","price":42.0,"product-id":"foo","quantity":42},{"name":"foo","price":42.
```

#### Route 3

```sh
curl -X POST http://localhost:9006/v1/100/checkout
```

```json
{"success":{"order-id":"238738674"}}‚èé
```

#### Deploying multiple definitions to the same site

Multiple API definitions can be deployed to a specific site (subdomain.domain),
as far their routes don't conflict.

Example: Let's say we have an API definition with ID/version `my-shopping-cart/0.0.1` deployed in domain `localhost:9006` ,
and we want to deploy another registered definition `my-todo-app/0.0.1` to the same domain.

```shell copy
golem api deployment deploy --host localhost:9006  my-todo-app/0.0.1

API deployment on localhost:9006 with definition my-shopping-cart/0.0.1
API deployment on localhost:9006 with definition my-todo-app/0.0.1

```

Now all the routes are available under the same domain `localhost:9006`. If there are any conflicts between the
routes of the two definitions, you will get a conflict error message.

If you try to deploy an API definition with routes that are already deployed and live,
then you will get a conflict error.

Example:

```shell copy
$ golem api deployment deploy --host localhost:9006 --definition my-todo-app/0.0.1

API deployment definitions conflict error: /v1/healthcheck
```
This is because the route `/v1/healthcheck` is already deployed in the `my-shopping-cart/0.0.1` definition.